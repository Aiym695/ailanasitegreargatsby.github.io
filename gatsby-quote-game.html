<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>What happens next?</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>
<header>
    <h1>What happens next?</h1>
</header>
<nav>
    <a href="index.html">Home</a>
    <a href="author.html">About the Author</a>
    <a href="summary.html">Summary</a>
    <a href="theme.html">Theme Analysis</a>
    <a href="characters.html">Characters</a>
    <a href="quotes.html">Quotes</a>
    <a href="gatsby-quote-game.html"class="active">What happens next?</a>
    <a href="conclusion.html">Conclusion</a>
</nav>
  <section id="wn-game">
  <div id="wn-excerpt" aria-live="polite">Loading excerpt...</div>

  <div id="wn-choices"></div>

  <div class="buttons-center">
    <button id="wn-next">Next</button>
    <button id="wn-restart">Restart</button>
    <div id="wn-feedback"></div>
  </div>
<div class="game-footer">
  <div class="game-info">
    <div>Score: <span id="wn-score">0</span></div>
    <div>Round: <span id="wn-round">0</span>/<span id="wn-total">0</span></div>
  </div>

  <details>
    <summary>Настройки игры</summary>
    <div>
      <label><input type="checkbox" id="wn-shuffle" checked> Перемешивать варианты</label><br>
      <label><input type="checkbox" id="wn-random-scenes" checked> Случайный порядок сцен</label>
    </div>
  </details>
</div>
</section>

<script>
(function(){
  const scenes = [
    {
      excerpt: 'Nick sees Gatsby reaching toward the green light across the bay; Gatsby watches the water and seems full of longing.',
      choices: [
        'Gatsby and Daisy meet privately and discuss their past. (Correct)',
        'Gatsby decides to sell his mansion and leave town.',
        'Tom publicly accuses Gatsby of criminal activity.',
        'Gatsby burns all his letters and retreats from society.'
      ],
      correct: 0
    },
    {
      excerpt: 'Tom and Daisy host a loud, careless party; guests gossip and drink while tensions simmer.',
      choices: [
        'A confrontation later happens between Tom and Gatsby in a hotel suite. (Correct)',
        'Nick runs for public office and leaves Long Island.',
        'Myrtle becomes the mayor of the next town.',
        'Gatsby reveals a new invention to the guests.'
      ],
      correct: 0
    },
    {
      excerpt: 'Myrtle runs into the street after being hurt during an argument; a car is involved nearby.',
      choices: [
        'A tragic accident occurs and a character is fatally struck. (Correct)',
        'Myrtle escapes to Europe the next day.',
        'The car drives off and no one notices anything happened.',
        'Daisy confesses her love for Myrtle.'
      ],
      correct: 0
    },
    {
      excerpt: 'Nick is invited to Gatsby’s party and watches guests who don’t really know their host.',
      choices: [
        'Nick later becomes closer to Gatsby and learns his true background. (Correct)',
        'Nick decides to write a bestselling novel immediately.',
        'Gatsby’s house is demolished the next morning.',
        'Nick never speaks to Gatsby again after that night.'
      ],
      correct: 0
    },
    {
      excerpt: 'George Wilson is distraught after Myrtle’s death and grows increasingly unstable.',
      choices: [
        'George eventually finds Gatsby and a tragic confrontation occurs. (Correct)',
        'George leaves New York to start a new life.',
        'Tom helps George open a new car repair shop.',
        'Nick adopts George as a business partner.'
      ],
      correct: 0
    },
    {
      excerpt: 'After Gatsby’s death, Daisy makes a decision about her future with Tom.',
      choices: [
        'Daisy quietly leaves town with Tom, avoiding responsibility. (Correct)',
        'Daisy confesses publicly and faces the consequences.',
        'Daisy takes over Gatsby’s mansion and throws more parties.',
        'Daisy dedicates herself to caring for Nick.'
      ],
      correct: 0
    },
    {
      excerpt: 'Nick reflects on his experiences in New York and the lives of the people he met.',
      choices: [
        'Nick decides to return to the Midwest, disillusioned. (Correct)',
        'Nick becomes the new owner of Gatsby’s house.',
        'Nick runs for mayor of New York.',
        'Nick stays in the city and throws even bigger parties.'
      ],
      correct: 0
    }
  ];

  let pool = scenes.slice();
  let current = null;
  let score = 0;
  let round = 0;

  const excerptEl = document.getElementById('wn-excerpt');
  const choicesEl = document.getElementById('wn-choices');
  const nextBtn = document.getElementById('wn-next');
  const restartBtn = document.getElementById('wn-restart');
  const feedbackEl = document.getElementById('wn-feedback');
  const scoreEl = document.getElementById('wn-score');
  const roundEl = document.getElementById('wn-round');
  const totalEl = document.getElementById('wn-total');
  const shuffleChoicesCheckbox = document.getElementById('wn-shuffle');
  const randomScenesCheckbox = document.getElementById('wn-random-scenes');

  function shuffle(a){
    for(let i=a.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];
    }
  }

  function newRound(){
    if(pool.length===0){
      pool = scenes.slice();
      if(randomScenesCheckbox.checked) shuffle(pool);
    }
    current = pool.shift();
    round++;
    roundEl.textContent = round;
    totalEl.textContent = scenes.length;
    excerptEl.textContent = current.excerpt;

    const choices = current.choices.map((c,i)=>({text:c,index:i}));
    if(shuffleChoicesCheckbox.checked) shuffle(choices);

    choicesEl.innerHTML = '';
    choices.forEach((cObj)=>{
      const btn = document.createElement('button');
      btn.className = 'wn-choice';
      btn.type = 'button';
      btn.textContent = cObj.text.replace(' (Correct)','');
      btn.dataset.choiceIndex = cObj.index;
      btn.addEventListener('click', ()=> selectChoice(btn, cObj.index));
      choicesEl.appendChild(btn);
    });

    feedbackEl.textContent='';
  }

  function selectChoice(button, choiceIndex){
    const btns = choicesEl.querySelectorAll('button');
    btns.forEach(b=>b.disabled=true);

    const isCorrect = choiceIndex==current.correct;
    if(isCorrect){
      feedbackEl.textContent='Correct!';
      score++;
      scoreEl.textContent = score;
      button.style.background='#e6ffef';
      button.style.borderColor='#8fd19e';
    } else {
      feedbackEl.textContent='Not quite — the correct answer is highlighted.';
      btns.forEach(b=>{
        if(Number(b.dataset.choiceIndex)===current.correct){
          b.style.background='#e6ffef';
          b.style.borderColor='#8fd19e';
        }
      });
      button.style.background='#ffecec';
      button.style.borderColor='#e09b9b';
    }
  }

  nextBtn.addEventListener('click', ()=> newRound());
  restartBtn.addEventListener('click', ()=>{
    pool = scenes.slice();
    score = 0; round = 0;
    scoreEl.textContent = score;
    roundEl.textContent = round;
    if(randomScenesCheckbox.checked) shuffle(pool);
    newRound();
  });

  totalEl.textContent = scenes.length;
  scoreEl.textContent = score;
  if(randomScenesCheckbox.checked) shuffle(pool);
  newRound();
})();
</script>
